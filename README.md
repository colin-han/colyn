# Colyn

Git Worktree ç®¡ç†å·¥å…· - ç®€åŒ–å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘å·¥ä½œæµã€‚

---

## åŠŸèƒ½ç‰¹ç‚¹

- **ç®€åŒ– worktree ç®¡ç†**ï¼šä¸€é”®åˆ›å»ºå’Œç®¡ç† git worktree
- **è‡ªåŠ¨ç«¯å£åˆ†é…**ï¼šé¿å…å¤šä¸ªå¼€å‘æœåŠ¡å™¨ç«¯å£å†²çª
- **è‡ªåŠ¨ç›®å½•åˆ‡æ¢**ï¼šå‘½ä»¤æ‰§è¡Œåè‡ªåŠ¨åˆ‡æ¢åˆ°ç›®æ ‡ç›®å½•
- **æ™ºèƒ½åˆ†æ”¯å¤„ç†**ï¼šè‡ªåŠ¨è¯†åˆ«æœ¬åœ°åˆ†æ”¯ã€è¿œç¨‹åˆ†æ”¯æˆ–åˆ›å»ºæ–°åˆ†æ”¯
- **è·¨å¹³å°æ”¯æŒ**ï¼šmacOSã€Linuxã€Windows

---

## å®‰è£…

### æ–¹å¼ 1ï¼šä½¿ç”¨å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
volta run yarn install-to ~/my-tools/colyn
```

å®‰è£…å®Œæˆåï¼Œé‡æ–°æ‰“å¼€ç»ˆç«¯å³å¯ä½¿ç”¨ `colyn` å‘½ä»¤ï¼ˆå·²è‡ªåŠ¨é…ç½® shell é›†æˆï¼‰ã€‚

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨é…ç½®

å¦‚æœè‡ªåŠ¨é…ç½®æœªç”Ÿæ•ˆï¼Œæ‰‹åŠ¨æ·»åŠ åˆ° shell é…ç½®æ–‡ä»¶ï¼š

```bash
# æ·»åŠ åˆ° ~/.zshrc æˆ– ~/.bashrc
source ~/my-tools/colyn/colyn.d/colyn.sh
```

è¯¦ç»†å®‰è£…è¯´æ˜è¯·å‚è€ƒ [docs/installation.md](docs/installation.md)ã€‚

---

## å¿«é€Ÿå¼€å§‹

### åˆå§‹åŒ–é¡¹ç›®

```bash
# åœ¨ç°æœ‰ git é¡¹ç›®ä¸­è¿è¡Œ
colyn init -p 10000
```

åˆå§‹åŒ–åçš„ç›®å½•ç»“æ„ï¼š

```
my-project/                    # æ ¹ç›®å½•
â”œâ”€â”€ my-project/                # ä¸»åˆ†æ”¯ç›®å½•
â”‚   â”œâ”€â”€ .git/
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ .env.local            # PORT=10000, WORKTREE=main
â”‚   â””â”€â”€ ...
â””â”€â”€ worktrees/                 # worktrees ç›®å½•
```

### åˆ›å»º worktree

```bash
# åˆ›å»ºæ–°çš„ worktreeï¼ˆè‡ªåŠ¨åˆ‡æ¢åˆ°ç›®æ ‡ç›®å½•ï¼‰
colyn add feature/login
# ğŸ“‚ å·²åˆ‡æ¢åˆ°: worktrees/task-1

# æŸ¥çœ‹å½“å‰ç›®å½•
pwd
# /path/to/project/worktrees/task-1
```

åˆ›å»ºåçš„ç›®å½•ç»“æ„ï¼š

```
my-project/
â”œâ”€â”€ my-project/                # ä¸»åˆ†æ”¯ç›®å½• (PORT=10000)
â””â”€â”€ worktrees/
    â””â”€â”€ task-1/                # æ–°çš„ worktree (PORT=10001)
        â”œâ”€â”€ src/
        â”œâ”€â”€ .env.local
        â””â”€â”€ ...
```

---

## å‘½ä»¤å‚è€ƒ

### `colyn init`

åˆå§‹åŒ– worktree ç®¡ç†ç»“æ„ã€‚

```bash
colyn init [options]

é€‰é¡¹ï¼š
  -p, --port <port>  ä¸»åˆ†æ”¯å¼€å‘æœåŠ¡å™¨ç«¯å£
```

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨æ£€æµ‹ç›®å½•çŠ¶æ€ï¼ˆç©ºç›®å½•ã€å·²åˆå§‹åŒ–ã€ç°æœ‰é¡¹ç›®ï¼‰
- åˆ›å»ºä¸»åˆ†æ”¯ç›®å½•å’Œ worktrees ç›®å½•
- é…ç½®ç¯å¢ƒå˜é‡ï¼ˆPORT å’Œ WORKTREEï¼‰
- é…ç½® .gitignore å¿½ç•¥ .env.local

### `colyn add <branch>`

ä¸ºæŒ‡å®šåˆ†æ”¯åˆ›å»ºæ–°çš„ worktreeã€‚

```bash
colyn add <branch>

å‚æ•°ï¼š
  branch  åˆ†æ”¯åç§°ï¼ˆæ”¯æŒæœ¬åœ°åˆ†æ”¯ã€è¿œç¨‹åˆ†æ”¯æˆ–æ–°å»ºåˆ†æ”¯ï¼‰
```

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨åˆ†é… worktree ID å’Œç«¯å£å·
- æ™ºèƒ½å¤„ç†åˆ†æ”¯ï¼ˆæœ¬åœ°ã€è¿œç¨‹ã€æ–°å»ºï¼‰
- å¤åˆ¶ä¸»åˆ†æ”¯ç¯å¢ƒå˜é‡å¹¶æ›´æ–°
- æ‰§è¡Œåè‡ªåŠ¨åˆ‡æ¢åˆ° worktree ç›®å½•

### `colyn merge [target]`

å°† worktree åˆ†æ”¯åˆå¹¶å›ä¸»åˆ†æ”¯ã€‚

```bash
colyn merge [target] [options]

å‚æ•°ï¼š
  target  å¯é€‰ï¼Œæ”¯æŒä»¥ä¸‹å½¢å¼ï¼š
          - æ•°å­—ï¼šæŒ‰ ID æŸ¥æ‰¾ï¼ˆå¦‚ colyn merge 1ï¼‰
          - åˆ†æ”¯åï¼šæŒ‰åˆ†æ”¯åæŸ¥æ‰¾ï¼ˆå¦‚ colyn merge feature/loginï¼‰
          - ä¸ä¼ ï¼šè‡ªåŠ¨è¯†åˆ«å½“å‰ worktree

é€‰é¡¹ï¼š
  --push     åˆå¹¶åè‡ªåŠ¨æ¨é€åˆ°è¿œç¨‹
  --no-push  åˆå¹¶åä¸æ¨é€ï¼Œä¸è¯¢é—®
```

**åŠŸèƒ½**ï¼š
- æ™ºèƒ½è¯†åˆ« worktreeï¼ˆIDã€åˆ†æ”¯åæˆ–è‡ªåŠ¨æ£€æµ‹ï¼‰
- å‰ç½®æ£€æŸ¥ï¼ˆä¸»åˆ†æ”¯å’Œ worktree å·¥ä½œç›®å½•å¿…é¡»å¹²å‡€ï¼‰
- ä½¿ç”¨ `--no-ff` ä¿æŒæ¸…æ™°çš„åˆ†æ”¯å†å²
- å¯é€‰æ¨é€åˆ°è¿œç¨‹ä»“åº“
- åˆå¹¶åä¿ç•™ worktreeï¼ˆç”±ç”¨æˆ·å†³å®šåˆ é™¤æ—¶æœºï¼‰

---

## ç¯å¢ƒå˜é‡

Colyn ä¼šåœ¨æ¯ä¸ª worktree çš„ `.env.local` ä¸­è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `PORT` | å¼€å‘æœåŠ¡å™¨ç«¯å£ | `10001` |
| `WORKTREE` | Worktree æ ‡è¯† | `1` æˆ– `main` |

---

## æ¶æ„è¯´æ˜

Colyn é‡‡ç”¨ Bash + Node.js åŒå±‚æ¶æ„ï¼š

```
shell/colyn.sh (Shell å‡½æ•°)
    â”‚
    â””â”€â”€â–º bin/colyn (Bash å…¥å£)
            â”‚
            â””â”€â”€â–º dist/index.js (Node.js æ ¸å¿ƒ)
                        â”‚
                 stderr â†’ å½©è‰²è¾“å‡º
                 stdout â†’ JSON ç»“æœ
                        â”‚
    â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€â”€â–º è§£æ JSON â”€â”€â–º cd ç›®æ ‡ç›®å½•
```

**ä¸ºä»€ä¹ˆéœ€è¦åŒå±‚æ¶æ„ï¼Ÿ**

å­è¿›ç¨‹æ— æ³•ä¿®æ”¹çˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ã€‚é€šè¿‡ shell å‡½æ•°åŒ…è£…ï¼Œå¯ä»¥ï¼š
1. æ•è· Node.js è¾“å‡ºçš„ JSON ç»“æœ
2. è§£æç›®æ ‡ç›®å½•
3. åœ¨å½“å‰ shell ä¸­æ‰§è¡Œ `cd` å‘½ä»¤

---

## å¼€å‘

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18ï¼ˆæ¨èä½¿ç”¨ [Volta](https://volta.sh) ç®¡ç†ï¼‰
- Git >= 2.15
- Yarn

### å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
volta run yarn install

# ç¼–è¯‘
volta run yarn build

# ç›‘å¬æ¨¡å¼ç¼–è¯‘
volta run yarn dev

# è¿è¡Œæµ‹è¯•
volta run yarn test

# æœ¬åœ°æµ‹è¯•
volta run yarn colyn init
```

### é¡¹ç›®ç»“æ„

```
colyn/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ colyn              # Bash å…¥å£è„šæœ¬
â”œâ”€â”€ shell/
â”‚   â””â”€â”€ colyn.sh           # Shell é›†æˆè„šæœ¬
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cli.ts             # CLI å…¥å£
â”‚   â”œâ”€â”€ commands/          # å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ types/             # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ install.js         # å®‰è£…è„šæœ¬
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â””â”€â”€ dist/                   # ç¼–è¯‘è¾“å‡º
```

---

## è·¯çº¿å›¾

- [x] `init` - åˆå§‹åŒ–é¡¹ç›®ç»“æ„
- [x] `add` - åˆ›å»º worktree
- [x] `merge` - åˆå¹¶ worktree åˆ°ä¸»åˆ†æ”¯
- [ ] `list` - åˆ—å‡ºæ‰€æœ‰ worktree
- [ ] `status` - æŸ¥çœ‹ worktree çŠ¶æ€
- [ ] `remove` - åˆ é™¤ worktree
- [ ] `checkout` - åœ¨ worktree ä¸­åˆ‡æ¢åˆ†æ”¯

---

## è®¸å¯è¯

MIT
