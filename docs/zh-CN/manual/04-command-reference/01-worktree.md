# å‘½ä»¤å‚è€ƒ â€” Worktree ç®¡ç†

[â† è¿”å›å‘½ä»¤å‚è€ƒ](README.md)

---

## å…¨å±€é€‰é¡¹

æ‰€æœ‰ Colyn å‘½ä»¤éƒ½æ”¯æŒä»¥ä¸‹å…¨å±€é€‰é¡¹ï¼š

### `-C, --no-color`

ç¦ç”¨å½©è‰²è¾“å‡ºã€‚

**é€‚ç”¨åœºæ™¯ï¼š**
- åœ¨ CI/CD ç¯å¢ƒä¸­è¿è¡Œ
- å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶
- ç»ˆç«¯ä¸æ”¯æŒé¢œè‰²æ˜¾ç¤º
- éœ€è¦çº¯æ–‡æœ¬è¾“å‡ºç”¨äºè„šæœ¬è§£æ

**ç¤ºä¾‹ï¼š**
```bash
colyn list --no-color           # åˆ—å‡º worktreeï¼ˆæ— é¢œè‰²ï¼‰
colyn info --short -C           # æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯ï¼ˆæ— é¢œè‰²ï¼‰
colyn checkout feature/test -C  # åˆ‡æ¢åˆ†æ”¯ï¼ˆæ— é¢œè‰²ï¼‰
```

---

## colyn init

åˆå§‹åŒ– Worktree ç®¡ç†ç»“æ„ã€‚

### è¯­æ³•

```bash
colyn init [é€‰é¡¹]
```

### é€‰é¡¹

| é€‰é¡¹ | çŸ­é€‰é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|--------|------|--------|
| `--port <port>` | `-p` | ä¸»åˆ†æ”¯å¼€å‘æœåŠ¡å™¨ç«¯å£å· | 10000 |
| `--yes` | `-y` | åœ¨"å·²æœ‰é¡¹ç›®"åœºæ™¯ä¸‹è·³è¿‡ç¡®è®¤æç¤º | å¦ |

### åŠŸèƒ½è¯´æ˜

`colyn init` ä¼šæ ¹æ®å½“å‰ç›®å½•çš„çŠ¶æ€é‡‡å–ä¸åŒçš„åˆå§‹åŒ–ç­–ç•¥ï¼š

#### 1. ç©ºç›®å½•
- åˆ›å»ºä¸»åˆ†æ”¯ç›®å½•ã€worktrees ç›®å½•å’Œé…ç½®ç›®å½•
- é…ç½®ç¯å¢ƒå˜é‡æ–‡ä»¶
- æç¤ºç”¨æˆ·åœ¨ä¸»åˆ†æ”¯ç›®å½•ä¸­åˆå§‹åŒ–é¡¹ç›®

#### 2. å·²æœ‰é¡¹ç›®
- æ˜¾ç¤ºå½“å‰æ–‡ä»¶åˆ—è¡¨å¹¶è¯¢é—®ç”¨æˆ·ç¡®è®¤
- åˆ›å»ºç›®å½•ç»“æ„å¹¶ç§»åŠ¨æ‰€æœ‰æ–‡ä»¶åˆ°ä¸»åˆ†æ”¯ç›®å½•
- å¦‚æœæ˜¯ git ä»“åº“ï¼Œæ£€æŸ¥å·¥ä½œç›®å½•å¿…é¡»å¹²å‡€
- é…ç½®ç¯å¢ƒå˜é‡å’Œ .gitignore
- **è‡ªåŠ¨æ£€æµ‹å·¥å…·é“¾æ’ä»¶**ï¼ˆnpm / Maven / Gradle / pipï¼‰ï¼Œå†™å…¥ `.colyn/settings.json`
- æ ¹æ®æ£€æµ‹åˆ°çš„æ’ä»¶è¿è¡Œåˆå§‹åŒ–ï¼ˆå†™å…¥å·¥å…·é“¾è¿è¡Œé…ç½®ã€å®‰è£…ä¾èµ–ç­‰ï¼‰

#### 3. å·²åˆå§‹åŒ–é¡¹ç›®ï¼ˆè¡¥å…¨æ¨¡å¼ï¼‰
- æ£€æµ‹ç¼ºå¤±çš„éƒ¨åˆ†å¹¶è¡¥å…¨
- ä¸ä¼šè¦†ç›–å·²æœ‰é…ç½®
- ç¯å¢ƒå˜é‡æ™ºèƒ½åˆå¹¶

### ç¤ºä¾‹

```bash
# äº¤äº’å¼è¯¢é—®ç«¯å£
$ colyn init
? è¯·è¾“å…¥ä¸»åˆ†æ”¯å¼€å‘æœåŠ¡å™¨ç«¯å£: (10000)

# ç›´æ¥æŒ‡å®šç«¯å£
$ colyn init --port 10000
$ colyn init -p 3000

# éäº¤äº’åœºæ™¯ï¼ˆCI/è„šæœ¬ï¼‰å»ºè®®åŒæ—¶æŒ‡å®š --port å’Œ --yes
$ colyn init -p 3000 --yes
```

### æ‰§è¡Œç»“æœ

åˆå§‹åŒ–åçš„ç›®å½•ç»“æ„ï¼š

```
my-project/                 # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ my-project/             # ä¸»åˆ†æ”¯ç›®å½•
â”‚   â”œâ”€â”€ .git/              # Git ä»“åº“ï¼ˆå¦‚æœæ˜¯ git é¡¹ç›®ï¼‰
â”‚   â”œâ”€â”€ src/               # æºä»£ç 
â”‚   â”œâ”€â”€ .env.local         # PORT=10000, WORKTREE=main
â”‚   â”œâ”€â”€ .gitignore         # åŒ…å« .env.local å¿½ç•¥è§„åˆ™
â”‚   â””â”€â”€ ...                # å…¶ä»–é¡¹ç›®æ–‡ä»¶
â”œâ”€â”€ worktrees/             # Worktree ç›®å½•ï¼ˆåˆå§‹ä¸ºç©ºï¼‰
â””â”€â”€ .colyn/                # Colyn é…ç½®ç›®å½•
    â””â”€â”€ settings.json      # é¡¹ç›®é…ç½®ï¼ˆåŒ…å« plugins å­—æ®µï¼‰
```

### å¸¸è§é”™è¯¯

| é”™è¯¯åœºæ™¯ | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ³• |
|---------|---------|---------|
| å·¥ä½œç›®å½•ä¸å¹²å‡€ | `âœ— å·¥ä½œç›®å½•ä¸å¹²å‡€ï¼Œå­˜åœ¨æœªæäº¤çš„æ›´æ”¹` | è¿è¡Œ `git add .` å’Œ `git commit`ï¼Œæˆ– `git stash` |
| ç›®å½•åå†²çª | `âœ— ä¸»åˆ†æ”¯ç›®å½•åä¸ç°æœ‰æ–‡ä»¶å†²çª` | é‡å‘½åæˆ–åˆ é™¤ä¸ä¸»åˆ†æ”¯ç›®å½•åŒåçš„æ–‡ä»¶ |
| æ— æ•ˆç«¯å£å· | `âœ— æ— æ•ˆçš„ç«¯å£å·` | è¾“å…¥ 1-65535 ä¹‹é—´çš„ç«¯å£å· |

### æç¤º

- åˆå§‹åŒ–æ˜¯æ‰€æœ‰å…¶ä»– Colyn å‘½ä»¤çš„å‰ç½®æ¡ä»¶
- ç«¯å£å·å¯ä»¥åœ¨ä¸»åˆ†æ”¯ç›®å½•çš„ `.env.local` ä¸­éšæ—¶ä¿®æ”¹
- è¡¥å…¨æ¨¡å¼åªæ·»åŠ ç¼ºå¤±éƒ¨åˆ†ï¼Œä¸ä¼šè¦†ç›–å·²æœ‰é…ç½®
- åœ¨éäº¤äº’ç¯å¢ƒä¸­ï¼Œè¯·æ˜¾å¼ä¼ å…¥ `--port`ï¼›å·²æœ‰é¡¹ç›®åœºæ™¯å»ºè®®é…åˆ `--yes`

---

## colyn add

ä¸ºæŒ‡å®šåˆ†æ”¯åˆ›å»ºæ–°çš„ Worktreeã€‚

### è¯­æ³•

```bash
colyn add <branch>
```

### å‚æ•°

| å‚æ•° | å¿…å¡« | è¯´æ˜ |
|------|------|------|
| `branch` | æ˜¯ | åˆ†æ”¯åç§°ï¼ˆæ”¯æŒæœ¬åœ°åˆ†æ”¯ã€è¿œç¨‹åˆ†æ”¯æˆ–æ–°å»ºåˆ†æ”¯ï¼‰ |

### åŠŸèƒ½è¯´æ˜

`colyn add` ä¼šæ™ºèƒ½å¤„ç†åˆ†æ”¯ï¼š

1. **æœ¬åœ°åˆ†æ”¯å­˜åœ¨** - ç›´æ¥ä½¿ç”¨æœ¬åœ°åˆ†æ”¯åˆ›å»º Worktree
2. **è¿œç¨‹åˆ†æ”¯å­˜åœ¨** - è‡ªåŠ¨åˆ›å»ºæœ¬åœ°è·Ÿè¸ªåˆ†æ”¯
3. **åˆ†æ”¯ä¸å­˜åœ¨** - åŸºäºä¸»åˆ†æ”¯åˆ›å»ºæ–°åˆ†æ”¯

åˆ›å»ºçš„ Worktree ä¼šï¼š
- è‡ªåŠ¨åˆ†é… IDï¼ˆé€’å¢ï¼‰
- è‡ªåŠ¨åˆ†é…ç«¯å£å·ï¼ˆä¸»ç«¯å£ + IDï¼‰
- å¤åˆ¶ä¸»åˆ†æ”¯ç¯å¢ƒå˜é‡å¹¶æ›´æ–° PORT å’Œ WORKTREE
- æ‰§è¡Œåè‡ªåŠ¨åˆ‡æ¢åˆ° Worktree ç›®å½•

**tmux é›†æˆ**ï¼ˆå¦‚æœåœ¨ tmux ä¸­ï¼‰ï¼š
- è‡ªåŠ¨åˆ›å»ºæ–°çš„ tmux window
- è®¾ç½® 3-pane å¸ƒå±€ï¼ˆClaude Code + Dev Server + Bashï¼‰
- è‡ªåŠ¨åˆ‡æ¢åˆ°æ–° window
- å¦‚æœä½¿ç”¨ iTerm2ï¼Œè‡ªåŠ¨è®¾ç½® tab title

### ç¤ºä¾‹

```bash
# åˆ›å»ºæ–°åˆ†æ”¯çš„ worktree
$ colyn add feature/login

# åŸºäºå·²æœ‰æœ¬åœ°åˆ†æ”¯åˆ›å»º worktree
$ colyn add bugfix/auth-error

# ä»è¿œç¨‹åˆ†æ”¯åˆ›å»º worktreeï¼ˆè‡ªåŠ¨å»é™¤ origin/ å‰ç¼€ï¼‰
$ colyn add origin/feature/payment

# æ‰§è¡Œåè‡ªåŠ¨åˆ‡æ¢åˆ° worktree ç›®å½•
$ pwd
/path/to/worktrees/task-1
```

### æ‰§è¡Œç»“æœ

```
âœ” ä½¿ç”¨æœ¬åœ°åˆ†æ”¯: feature/login
âœ” Worktree åˆ›å»ºå®Œæˆ: task-1
âœ” ç¯å¢ƒå˜é‡é…ç½®å®Œæˆ
âœ” é…ç½®æ–‡ä»¶æ›´æ–°å®Œæˆ

âœ“ Worktree åˆ›å»ºæˆåŠŸï¼

Worktree ä¿¡æ¯ï¼š
  ID: 1
  åˆ†æ”¯: feature/login
  è·¯å¾„: /path/to/worktrees/task-1
  ç«¯å£: 10001

åç»­æ“ä½œï¼š
  1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£å·²è‡ªåŠ¨é…ç½®ï¼‰ï¼š
     npm run dev

  2. æŸ¥çœ‹æ‰€æœ‰ worktreeï¼š
     colyn list

ğŸ“‚ å·²åˆ‡æ¢åˆ°: /path/to/worktrees/task-1
```

åˆ›å»ºåçš„ç›®å½•ç»“æ„ï¼š

```
my-project/
â”œâ”€â”€ my-project/                # ä¸»åˆ†æ”¯ç›®å½• (PORT=10000)
â””â”€â”€ worktrees/
    â””â”€â”€ task-1/                # æ–°çš„ worktree (PORT=10001)
        â”œâ”€â”€ src/
        â”œâ”€â”€ .env.local         # PORT=10001, WORKTREE=1
        â””â”€â”€ ...
```

### å¸¸è§é”™è¯¯

| é”™è¯¯åœºæ™¯ | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ³• |
|---------|---------|---------|
| æœªåˆå§‹åŒ– | `âœ— å½“å‰ç›®å½•æœªåˆå§‹åŒ–` | è¿è¡Œ `colyn init` |
| åˆ†æ”¯å·²æœ‰ worktree | `âœ— åˆ†æ”¯å·²å…³è”åˆ°ç°æœ‰ worktree` | åˆ‡æ¢åˆ°å·²æœ‰ worktreeï¼Œæˆ–åˆ é™¤åé‡å»º |
| åˆ†æ”¯åç§°æ— æ•ˆ | `âœ— æ— æ•ˆçš„åˆ†æ”¯åç§°` | ä½¿ç”¨æœ‰æ•ˆçš„åˆ†æ”¯åç§°ï¼ˆå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦å’Œæ–œæ ï¼‰ |

### æç¤º

- ID ä¸ä¼šé‡ç”¨ï¼Œå³ä½¿åˆ é™¤äº†æŸä¸ª worktree
- å¯ä»¥åœ¨é¡¹ç›®çš„ä»»æ„ä½ç½®è¿è¡Œæ­¤å‘½ä»¤
- åˆ†æ”¯åä¼šè‡ªåŠ¨å»é™¤ `origin/` å‰ç¼€
- å‘½ä»¤æ‰§è¡Œåä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æ–°åˆ›å»ºçš„ worktree ç›®å½•

---

## colyn list

åˆ—å‡ºæ‰€æœ‰ Worktreeã€‚

### è¯­æ³•

```bash
colyn list [é€‰é¡¹]
```

### é€‰é¡¹

| é€‰é¡¹ | çŸ­é€‰é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|--------|------|--------|
| `--json` | - | ä»¥ JSON æ ¼å¼è¾“å‡º | å¦ |
| `--paths` | `-p` | åªè¾“å‡ºè·¯å¾„ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ | å¦ |
| `--no-main` | - | ä¸æ˜¾ç¤ºä¸»åˆ†æ”¯ | å¦ï¼ˆæ˜¾ç¤ºä¸»åˆ†æ”¯ï¼‰ |
| `--refresh [interval]` | `-r` | ç›‘å¬æ–‡ä»¶å˜åŒ–è‡ªåŠ¨åˆ·æ–°ï¼ˆå¯é€‰ï¼šåˆ·æ–°é—´éš”ç§’æ•°ï¼‰ | å¦ |

### åŠŸèƒ½è¯´æ˜

`colyn list` æä¾›å››ç§è¾“å‡ºæ¨¡å¼ï¼š

#### 1. è¡¨æ ¼æ ¼å¼ï¼ˆé»˜è®¤ï¼‰
- å½©è‰²è¾“å‡ºï¼Œç¾è§‚æ˜“è¯»
- å½“å‰æ‰€åœ¨ worktree ç”¨ `â†’` ç®­å¤´æ ‡è¯†
- ä¸»åˆ†æ”¯ ID æ˜¾ç¤ºä¸º `0-main`
- æ˜¾ç¤º git çŠ¶æ€å’Œä¸ä¸»åˆ†æ”¯çš„å·®å¼‚
- å“åº”å¼å¸ƒå±€ï¼šæ ¹æ®ç»ˆç«¯å®½åº¦è‡ªåŠ¨è°ƒæ•´æ˜¾ç¤ºåˆ—

#### 2. JSON æ ¼å¼ï¼ˆ`--json`ï¼‰
- æœºå™¨å¯è¯»ï¼Œä¾¿äºè„šæœ¬å¤„ç†
- åŒ…å«å®Œæ•´ä¿¡æ¯
- æ•°ç»„æ ¼å¼

#### 3. è·¯å¾„æ ¼å¼ï¼ˆ`--paths`ï¼‰
- æ¯è¡Œä¸€ä¸ªè·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
- ä¾¿äºç®¡é“æ“ä½œ

#### 4. è‡ªåŠ¨åˆ·æ–°ï¼ˆ`--refresh`ï¼‰
- è‡ªåŠ¨ç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶åˆ·æ–°è¡¨æ ¼
- ä»…æ”¯æŒè¡¨æ ¼è¾“å‡ºï¼Œä¸èƒ½ä¸ `--json` æˆ– `--paths` åŒæ—¶ä½¿ç”¨
- é»˜è®¤æŒ‰æ–‡ä»¶äº‹ä»¶åˆ·æ–°ï¼›å¯é€‰ä¼ å…¥ç§’æ•°å‚æ•°ä½œä¸ºåˆ·æ–°é—´éš”ï¼ˆæ­£æ•´æ•°ï¼‰

### ç¤ºä¾‹

**è¡¨æ ¼æ ¼å¼ï¼ˆé»˜è®¤ï¼‰ï¼š**

```bash
$ colyn list

ID    Branch            Port   Status      Diff   Path
  0-main   main         10000              -      my-app
  1   feature/login     10001  M:3         â†‘2 â†“1  worktrees/task-1
â†’ 2   feature/dashboard 10002              â†‘5     worktrees/task-2
```

**è¯´æ˜ï¼š**
- `â†’` ç®­å¤´æ ‡è¯†å½“å‰æ‰€åœ¨çš„ worktreeï¼Œæ•´è¡Œé’è‰²é«˜äº®
- `Status`: æœªæäº¤ä¿®æ”¹ç»Ÿè®¡ï¼ˆM:å·²ä¿®æ”¹ S:å·²æš‚å­˜ ?:æœªè·Ÿè¸ªï¼‰
- `Diff`: ä¸ä¸»åˆ†æ”¯çš„æäº¤å·®å¼‚ï¼ˆâ†‘é¢†å…ˆ â†“è½å âœ“å·²åŒæ­¥ï¼‰

**JSON æ ¼å¼ï¼š**

```bash
$ colyn list --json
```

```json
[
  {
    "id": null,
    "branch": "main",
    "port": 10000,
    "path": "my-app",
    "isMain": true,
    "isCurrent": false,
    "status": { "modified": 0, "staged": 0, "untracked": 0 },
    "diff": { "ahead": 0, "behind": 0 }
  },
  {
    "id": 1,
    "branch": "feature/login",
    "port": 10001,
    "path": "worktrees/task-1",
    "isMain": false,
    "isCurrent": false,
    "status": { "modified": 3, "staged": 1, "untracked": 2 },
    "diff": { "ahead": 2, "behind": 1 }
  }
]
```

**è·¯å¾„æ ¼å¼ï¼š**

```bash
$ colyn list --paths
my-app
worktrees/task-1
worktrees/task-2

# åªè¾“å‡ºä»»åŠ¡ worktree è·¯å¾„
$ colyn list --paths --no-main
worktrees/task-1
worktrees/task-2
```

**è‡ªåŠ¨åˆ·æ–°æ¨¡å¼ï¼š**

```bash
# ç›‘å¬æ–‡ä»¶å˜åŒ–è‡ªåŠ¨åˆ·æ–°
$ colyn list -r

# æ¯ 2 ç§’åˆ·æ–°ä¸€æ¬¡
$ colyn list --refresh 2
```

### è„šæœ¬ä½¿ç”¨ç¤ºä¾‹

```bash
# åœ¨æ‰€æœ‰ worktree ä¸­æ‰§è¡Œå‘½ä»¤
$ colyn list --paths | xargs -I {} sh -c 'cd {} && git status'

# ç»Ÿè®¡ worktree æ•°é‡
$ colyn list --paths --no-main | wc -l

# ä½¿ç”¨ jq å¤„ç† JSON è¾“å‡º
$ colyn list --json | jq '.[] | select(.isMain == false) | .path'
```

### å¸¸è§é”™è¯¯

| é”™è¯¯åœºæ™¯ | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ³• |
|---------|---------|---------|
| é¡¹ç›®æœªåˆå§‹åŒ– | `âœ— å½“å‰ç›®å½•æœªåˆå§‹åŒ–` | è¿è¡Œ `colyn init` |
| é€‰é¡¹å†²çª | `âœ— --json å’Œ --paths ä¸èƒ½åŒæ—¶ä½¿ç”¨` | é€‰æ‹©å…¶ä¸­ä¸€ç§è¾“å‡ºæ ¼å¼ |
| åˆ·æ–°æ¨¡å¼å†²çª | `âœ— --refresh ä¸èƒ½ä¸ --json æˆ– --paths åŒæ—¶ä½¿ç”¨` | åˆ‡æ¢ä¸ºè¡¨æ ¼æ¨¡å¼ |

### æç¤º

- å¯ä»¥åœ¨é¡¹ç›®çš„ä»»æ„ä½ç½®è¿è¡Œ
- è·¯å¾„è¾“å‡ºä¸ºç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„
- ä¸»åˆ†æ”¯çš„ ID æ˜¾ç¤ºä¸º `0-main`
- ç»ˆç«¯çª„æ—¶è¡¨æ ¼ä¼šè‡ªåŠ¨éšè—ä¸é‡è¦çš„åˆ—

---

## colyn list-project

åˆ—å‡ºæ‰€æœ‰ tmux session ä¸­çš„é¡¹ç›®å’Œ Worktreeã€‚

**åˆ«åï¼š** `lsp`

### è¯­æ³•

```bash
colyn list-project [é€‰é¡¹]
colyn lsp [é€‰é¡¹]        # ä½¿ç”¨åˆ«å
```

### é€‰é¡¹

| é€‰é¡¹ | çŸ­é€‰é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|--------|------|--------|
| `--json` | - | ä»¥ JSON æ ¼å¼è¾“å‡º | å¦ |
| `--paths` | `-p` | åªè¾“å‡ºè·¯å¾„ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ | å¦ |

### åŠŸèƒ½è¯´æ˜

`colyn list-project` é€šè¿‡ tmux API è·å–æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„é¡¹ç›®ï¼Œå¹¶æ˜¾ç¤ºæ¯ä¸ªé¡¹ç›®çš„ worktree ä¿¡æ¯ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- è·¨é¡¹ç›®æŸ¥çœ‹ï¼šä¸€æ¬¡æ€§æŸ¥çœ‹æ‰€æœ‰ tmux session ä¸­çš„ colyn é¡¹ç›®
- å®Œå…¨å¤ç”¨ `list` å‘½ä»¤çš„æ•°æ®ç»“æ„å’Œè¾“å‡ºæ ¼å¼
- æ”¯æŒä¸‰ç§è¾“å‡ºæ¨¡å¼ï¼šè¡¨æ ¼ã€JSONã€è·¯å¾„

**ä¸ `list` å‘½ä»¤çš„åŒºåˆ«ï¼š**
- `list` - æŸ¥çœ‹**å½“å‰é¡¹ç›®**çš„æ‰€æœ‰ worktree
- `list-project` - æŸ¥çœ‹**æ‰€æœ‰ tmux session ä¸­é¡¹ç›®**çš„æ‰€æœ‰ worktree

**è¦æ±‚ï¼š**
- å¿…é¡»å®‰è£… tmux
- è‡³å°‘æœ‰ä¸€ä¸ª tmux session åœ¨è¿è¡Œ
- Session çš„ window 0 pane 0 å¿…é¡»åœ¨é¡¹ç›®ç›®å½•ä¸‹

### ç¤ºä¾‹

**è¡¨æ ¼æ ¼å¼ï¼ˆé»˜è®¤ï¼‰ï¼š**

```bash
$ colyn list-project

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session â”‚ Project â”‚ Path             â”‚ Worktrees â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ backend â”‚ backend â”‚ /path/to/backend â”‚ 2         â”‚
â”‚ colyn   â”‚ colyn   â”‚ /path/to/colyn   â”‚ 4         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

backend çš„ Worktrees:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID       â”‚ Branch       â”‚ Port â”‚ Status â”‚ Diff â”‚ Path             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   0-main â”‚ develop      â”‚ 3010 â”‚        â”‚ -    â”‚ backend          â”‚
â”‚   1      â”‚ feature/auth â”‚ 3011 â”‚        â”‚ âœ“    â”‚ worktrees/task-1 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è·¯å¾„æ ¼å¼ï¼š**

```bash
$ colyn list-project --paths
/path/to/backend/backend
/path/to/backend/worktrees/task-1
/path/to/colyn/colyn
/path/to/colyn/worktrees/task-1
```

### è„šæœ¬ä½¿ç”¨ç¤ºä¾‹

```bash
# åœ¨æ‰€æœ‰é¡¹ç›®çš„æ‰€æœ‰ worktree ä¸­è¿è¡Œ git status
$ colyn list-project --paths | xargs -I {} sh -c 'echo "=== {} ===" && cd {} && git status'

# ç»Ÿè®¡æ€»çš„ worktree æ•°é‡
$ colyn list-project --paths | wc -l

# æŸ¥çœ‹ç‰¹å®šé¡¹ç›®çš„ worktree
$ colyn list-project --json | jq '.[] | select(.projectName == "colyn")'
```

### å¸¸è§é”™è¯¯

| é”™è¯¯åœºæ™¯ | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ³• |
|---------|---------|---------|
| tmux æœªå®‰è£… | `âœ— tmux æœªå®‰è£…` | å®‰è£… tmuxï¼š`brew install tmux` (macOS) æˆ– `apt install tmux` (Linux) |
| æ—  tmux session | `æš‚æ— é¡¹ç›®` | åˆ›å»º tmux sessionï¼š`colyn tmux` |
| é€‰é¡¹å†²çª | `âœ— --json å’Œ --paths ä¸èƒ½åŒæ—¶ä½¿ç”¨` | é€‰æ‹©å…¶ä¸­ä¸€ç§è¾“å‡ºæ ¼å¼ |

---

## colyn merge

å°† Worktree åˆ†æ”¯åˆå¹¶å›ä¸»åˆ†æ”¯ã€‚

### è¯­æ³•

```bash
colyn merge [target] [é€‰é¡¹]
```

### å‚æ•°

| å‚æ•° | å¿…å¡« | è¯´æ˜ |
|------|------|------|
| `target` | å¦ | æ”¯æŒä»¥ä¸‹å½¢å¼ï¼š<br>- æ•°å­—ï¼šæŒ‰ ID æŸ¥æ‰¾ï¼ˆå¦‚ `1`ï¼‰<br>- åˆ†æ”¯åï¼šæŒ‰åˆ†æ”¯åæŸ¥æ‰¾ï¼ˆå¦‚ `feature/login`ï¼‰<br>- ä¸ä¼ ï¼šè‡ªåŠ¨è¯†åˆ«å½“å‰ worktree |

### é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| `--push` | åˆå¹¶åè‡ªåŠ¨æ¨é€åˆ°è¿œç¨‹ |
| `--no-push` | åˆå¹¶åä¸æ¨é€ï¼ˆè·³è¿‡è¯¢é—®ï¼‰ |
| `--no-rebase` | ä½¿ç”¨ merge è€Œé rebase æ›´æ–° worktree |
| `--no-update` | åˆå¹¶åä¸è‡ªåŠ¨æ›´æ–°å½“å‰ worktree |
| `--update-all` | åˆå¹¶åæ›´æ–°æ‰€æœ‰ worktrees |
| `--no-fetch` | è·³è¿‡ä»è¿œç¨‹æ‹‰å–ä¸»åˆ†æ”¯æœ€æ–°ä»£ç  |
| `--skip-build` | è·³è¿‡ lint å’Œ build æ£€æŸ¥ |
| `--verbose` / `-v` | æ˜¾ç¤º lint/build çš„å®Œæ•´å‘½ä»¤è¾“å‡ºï¼ˆå¤±è´¥æ—¶ï¼‰ |

### åŠŸèƒ½è¯´æ˜

`colyn merge` é‡‡ç”¨ä¸¤æ­¥åˆå¹¶ç­–ç•¥ï¼Œä½¿ç”¨ `--no-ff` ä¿æŒæ¸…æ™°çš„åˆ†æ”¯å†å²ï¼š

**æ­¥éª¤ 1ï¼šåœ¨ Worktree ä¸­æ›´æ–°ä¸»åˆ†æ”¯ä»£ç **
- åœ¨ worktree ä¸­æ‰§è¡Œ `git rebase main`
- å¦‚æœæœ‰å†²çªï¼Œåœ¨ worktree ä¸­è§£å†³ï¼ˆä¸å½±å“ä¸»åˆ†æ”¯ï¼‰

**æ­¥éª¤ 2ï¼šåœ¨ä¸»åˆ†æ”¯ä¸­åˆå¹¶ Worktree åˆ†æ”¯**
- åœ¨ä¸»åˆ†æ”¯ä¸­æ‰§è¡Œ `git merge --no-ff <branch>`
- å¼ºåˆ¶åˆ›å»ºåˆå¹¶æäº¤ï¼Œä¿æŒæ¸…æ™°çš„åˆ†æ”¯å†å²

**å‰ç½®æ£€æŸ¥ï¼š**
- ä¸»åˆ†æ”¯å·¥ä½œç›®å½•å¿…é¡»å¹²å‡€
- Worktree å·¥ä½œç›®å½•å¿…é¡»å¹²å‡€
- æ ¹æ®é¡¹ç›®é…ç½®çš„å·¥å…·é“¾æ’ä»¶è¿è¡Œ lint å’Œç¼–è¯‘æ£€æŸ¥

### ç¤ºä¾‹

```bash
# åœ¨ worktree ç›®å½•ä¸­åˆå¹¶
$ cd worktrees/task-1
$ colyn merge

# é€šè¿‡ ID åˆå¹¶
$ colyn merge 1

# é€šè¿‡åˆ†æ”¯ååˆå¹¶
$ colyn merge feature/login

# åˆå¹¶åè‡ªåŠ¨æ¨é€
$ colyn merge 1 --push
```

### å¤„ç†åˆå¹¶å†²çª

å¦‚æœåœ¨ worktree ä¸­åˆå¹¶ä¸»åˆ†æ”¯æ—¶å‘ç”Ÿå†²çªï¼š

```
âœ— å˜åŸºä¸»åˆ†æ”¯æ—¶å‘ç”Ÿå†²çª

è§£å†³æ­¥éª¤ï¼š
  1. è¿›å…¥ worktree ç›®å½•è§£å†³å†²çªï¼š
     cd worktrees/task-1
  2. ç¼–è¾‘å†²çªæ–‡ä»¶ï¼Œè§£å†³å†²çªæ ‡è®°
  3. æ·»åŠ å·²è§£å†³çš„æ–‡ä»¶ï¼š
     git add <file>
  4. ç»§ç»­å˜åŸºï¼š
     git rebase --continue
  5. é‡æ–°è¿è¡Œåˆå¹¶å‘½ä»¤ï¼š
     colyn merge feature/login
```

### å¸¸è§é”™è¯¯

| é”™è¯¯åœºæ™¯ | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ³• |
|---------|---------|---------|
| ä¸»åˆ†æ”¯ä¸å¹²å‡€ | `âœ— ä¸»åˆ†æ”¯ç›®å½•æœ‰æœªæäº¤çš„æ›´æ”¹` | æäº¤æˆ– stash ä¸»åˆ†æ”¯çš„æ›´æ”¹ |
| Worktree ä¸å¹²å‡€ | `âœ— Worktree ç›®å½•æœ‰æœªæäº¤çš„æ›´æ”¹` | æäº¤ worktree çš„æ›´æ”¹ |
| Lint æ£€æŸ¥å¤±è´¥ | `âœ— Lint æ£€æŸ¥å¤±è´¥` | ä¿®å¤ lint é”™è¯¯åé‡è¯• |
| ç¼–è¯‘å¤±è´¥ | `âœ— ç¼–è¯‘å¤±è´¥` | ä¿®å¤ç¼–è¯‘é”™è¯¯åé‡è¯• |

---

## colyn remove

åˆ é™¤ä¸å†éœ€è¦çš„ Worktreeã€‚

### è¯­æ³•

```bash
colyn remove [target] [é€‰é¡¹]
```

### å‚æ•°

| å‚æ•° | å¿…å¡« | è¯´æ˜ |
|------|------|------|
| `target` | å¦ | æ”¯æŒä»¥ä¸‹å½¢å¼ï¼š<br>- æ•°å­—ï¼šæŒ‰ ID æŸ¥æ‰¾ï¼ˆå¦‚ `1`ï¼‰<br>- åˆ†æ”¯åï¼šæŒ‰åˆ†æ”¯åæŸ¥æ‰¾ï¼ˆå¦‚ `feature/login`ï¼‰<br>- ä¸ä¼ ï¼šè‡ªåŠ¨è¯†åˆ«å½“å‰ worktree |

### é€‰é¡¹

| é€‰é¡¹ | çŸ­é€‰é¡¹ | è¯´æ˜ |
|------|--------|------|
| `--force` | `-f` | å¼ºåˆ¶åˆ é™¤ï¼ˆå¿½ç•¥æœªæäº¤çš„æ›´æ”¹ï¼‰ |
| `--yes` | `-y` | è·³è¿‡æ‰€æœ‰ç¡®è®¤æç¤ºï¼ˆé»˜è®¤ä¿ç•™æœ¬åœ°åˆ†æ”¯ï¼‰ |

### åŠŸèƒ½è¯´æ˜

`colyn remove` å®‰å…¨åœ°åˆ é™¤ worktreeï¼š

**å‰ç½®æ£€æŸ¥ï¼š**
- æ£€æŸ¥æœªæäº¤æ›´æ”¹ï¼ˆæœ‰æ›´æ”¹æ—¶æ‹’ç»åˆ é™¤ï¼Œé™¤é `--force`ï¼‰
- æ£€æŸ¥åˆ†æ”¯åˆå¹¶çŠ¶æ€ï¼ˆæœªåˆå¹¶æ—¶æ˜¾ç¤ºè­¦å‘Šï¼‰

**åˆ é™¤æµç¨‹ï¼š**
1. æ˜¾ç¤ºå°†è¦åˆ é™¤çš„ worktree ä¿¡æ¯
2. è¯¢é—®ç”¨æˆ·ç¡®è®¤ï¼ˆå¯ç”¨ `--yes` è·³è¿‡ï¼‰
3. æ‰§è¡Œ `git worktree remove`
4. è¯¢é—®æ˜¯å¦åŒæ—¶åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆ`--yes` æ—¶è·³è¿‡å¹¶é»˜è®¤ä¿ç•™ï¼‰
5. å¦‚æœå½“å‰åœ¨è¢«åˆ é™¤çš„ worktree ä¸­ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸»åˆ†æ”¯ç›®å½•

### ç¤ºä¾‹

```bash
# åœ¨ worktree ç›®å½•ä¸­åˆ é™¤
$ cd worktrees/task-1
$ colyn remove

# é€šè¿‡ ID åˆ é™¤
$ colyn remove 1

# é€šè¿‡åˆ†æ”¯ååˆ é™¤
$ colyn remove feature/login

# å¼ºåˆ¶åˆ é™¤ï¼ˆå¿½ç•¥æœªæäº¤æ›´æ”¹ï¼‰
$ colyn remove 1 --force

# å¿«é€Ÿåˆ é™¤ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
$ colyn remove 1 -y
```

### å¸¸è§é”™è¯¯

| é”™è¯¯åœºæ™¯ | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ³• |
|---------|---------|---------|
| Worktree ä¸å­˜åœ¨ | `âœ— æ‰¾ä¸åˆ° worktree` | æ£€æŸ¥ ID æˆ–åˆ†æ”¯åï¼Œè¿è¡Œ `colyn list` æŸ¥çœ‹ |
| æœ‰æœªæäº¤æ›´æ”¹ | `âœ— æ— æ³•åˆ é™¤ï¼šå­˜åœ¨æœªæäº¤çš„æ›´æ”¹` | æäº¤æ›´æ”¹æˆ–ä½¿ç”¨ `--force` |

### æç¤º

- åˆ é™¤å‰ä¼šæ£€æŸ¥æœªæäº¤æ›´æ”¹ï¼Œé˜²æ­¢æ„å¤–ä¸¢å¤±å·¥ä½œ
- æœªåˆå¹¶åˆ†æ”¯åªæ˜¾ç¤ºè­¦å‘Šï¼Œå…è®¸ç»§ç»­åˆ é™¤
- å¦‚æœå½“å‰åœ¨è¢«åˆ é™¤çš„ worktree ä¸­ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸»åˆ†æ”¯ç›®å½•
- å¯ä»¥åœ¨é¡¹ç›®çš„ä»»æ„ä½ç½®è¿è¡Œ
